(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b44aafa"],{ab9f:function(e,t,a){"use strict";a.r(t);var l=a("7a23");const o={class:"users-manage"},s={key:0,class:"font-warning font-bold"},r={key:1,class:"font-red font-bold"},n={key:2,class:"font-red font-bold"},c={key:3,class:"font-warning font-bold"},i={key:4,class:"font-green font-bold"};function d(e,t,a,d,p,u){const m=Object(l["resolveComponent"])("el-button"),b=Object(l["resolveComponent"])("search-class"),y=Object(l["resolveComponent"])("Preview"),h=Object(l["resolveComponent"])("Approval"),f=Object(l["resolveComponent"])("table-list"),O=Object(l["resolveComponent"])("form-list"),j=Object(l["resolveComponent"])("el-drawer");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,[Object(l["createVNode"])(b,{searchInit:e.searchInit,refresh:e.pageParams.refresh,"onUpdate:refresh":t[2]||(t[2]=t=>e.pageParams.refresh=t),onSearch:e.search},{"left-btn":Object(l["withCtx"])(()=>[Object(l["withDirectives"])(Object(l["createVNode"])(m,{onClick:t[0]||(t[0]=t=>e.setFn()),class:"background-btn",size:"small",type:"primary",plain:""},{default:Object(l["withCtx"])(()=>t[8]||(t[8]=[Object(l["createTextVNode"])("新增信息 ")])),_:1},512),[[l["vShow"],"add"===e.authorization]]),Object(l["createVNode"])(m,{type:"danger",plain:"",size:"small",onClick:t[1]||(t[1]=t=>e.tools.delMultiple("message",e.selection,e.pageParams))},{default:Object(l["withCtx"])(()=>t[9]||(t[9]=[Object(l["createTextVNode"])("删除 ")])),_:1})]),_:1},8,["searchInit","refresh","onSearch"]),Object(l["createVNode"])(f,{selection:e.selection,"onUpdate:selection":t[4]||(t[4]=t=>e.selection=t),columns:e.tableColumns,url:"/message/getListByPage","query-data":e.searchInfo,refresh:e.pageParams.refresh,"onUpdate:refresh":t[5]||(t[5]=t=>e.pageParams.refresh=t)},{status:Object(l["withCtx"])(e=>[-1===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",s,"未提交")):Object(l["createCommentVNode"])("",!0),0===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",r,"审核驳回")):Object(l["createCommentVNode"])("",!0),2===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",n,"禁用")):Object(l["createCommentVNode"])("",!0),11===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",c,"待审核")):Object(l["createCommentVNode"])("",!0),1===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",i,"启用")):Object(l["createCommentVNode"])("",!0)]),default:Object(l["withCtx"])(a=>[Object(l["withDirectives"])(Object(l["createVNode"])(m,{type:"primary",size:"small",onClick:t=>e.setFn(a)},{default:Object(l["withCtx"])(()=>t[10]||(t[10]=[Object(l["createTextVNode"])("查看/修改 ")])),_:2},1032,["onClick"]),[[l["vShow"],"add"===e.authorization]]),Object(l["createVNode"])(m,{type:"danger",size:"small",onClick:t=>e.tools.deleteById("message",a["row"].id,e.pageParams)},{default:Object(l["withCtx"])(()=>t[11]||(t[11]=[Object(l["createTextVNode"])("删除 ")])),_:2},1032,["onClick"]),Object(l["createVNode"])(y,{"ok-data":a["row"]},null,8,["ok-data"]),Object(l["createVNode"])(h,{data:a,refresh:e.pageParams.refresh,"onUpdate:refresh":t[3]||(t[3]=t=>e.pageParams.refresh=t),"table-name":"message","type-code":"common_approval",onApproval:e.approvalFn},null,8,["data","refresh","onApproval"])]),_:1},8,["selection","columns","query-data","refresh"]),e.apply?(Object(l["openBlock"])(),Object(l["createBlock"])(j,{key:0,title:"详细信息",modelValue:e.pageParams.isDrawer,"onUpdate:modelValue":t[6]||(t[6]=t=>e.pageParams.isDrawer=t),direction:"rtl","append-to-body":!1,"destroy-on-close":!0,size:"40%","before-close":e.tools.handleClose},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(O,{ref:"msgForm",list:e.formList,isEdit:e.pageParams.isEdit,onSubmit:e.submit},null,8,["list","isEdit","onSubmit"])]),_:1},8,["modelValue","before-close"])):(Object(l["openBlock"])(),Object(l["createBlock"])(j,{key:1,title:"详细信息",modelValue:e.pageParams.isDrawer,"onUpdate:modelValue":t[7]||(t[7]=t=>e.pageParams.isDrawer=t),direction:"rtl","append-to-body":!1,"destroy-on-close":!0,size:"40%"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(O,{list:e.applyParam,isEdit:e.pageParams.isEdit,onSubmit:e.submit},null,8,["list","isEdit","onSubmit"])]),_:1},8,["modelValue"]))])}a("14d9");var p=a("6605"),u=a("f220"),m=a("44a6"),b=a("d6de"),y=a("b02f"),h=a("f10b"),f=a("1f4d"),O=a("afbc"),j=Object(l["defineComponent"])({name:"",components:{FormList:f["a"],SearchClass:u["a"],TableList:b["a"],Preview:y["a"],Approval:h["a"]},setup:()=>{const e=Object(l["reactive"])({nowRow:{sequence:null,id:null},pageParams:{isEdit:!1,isDrawer:!1,refresh:!1},tableData:[],typeData:[],searchInfo:{status:null,name:null,typeId:null},selection:[],tableColumns:[{valueKey:"selection",label:"",type:"selection"},{valueKey:"name",label:"题目",width:180},{valueKey:"img",label:"封面",width:180},{valueKey:"typeId",label:"栏目类型",list:[]},{valueKey:"status",type:"slot",width:120,label:"状态"},{valueKey:"created",label:"创建日期",type:"time"}],searchInit:[{name:"isSelect",desc:"状态",placeholder:"选择状态",value:"status",valueKey:"status",defaultValue:null,options:[{status:null,name:"不限制"},{status:"-1",name:"未提交"},{status:"11",name:"待审核"},{status:"0",name:"驳回"},{status:"1",name:"启用"},{status:"2",name:"禁用"}]},{name:"isSelectTree",desc:"消息类型",value:"typeId",placeholder:"请选择选择消息类型",options:[],formatProps:{checkStrictly:!0,label:"name",value:"id"}}],apply:!1,applyParam:[{label:"索引",key:"id",value:null,defaultValue:null},{type:"input",label:"标题",key:"name",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"来源",key:"source",width:"",value:null,required:!0,defaultValue:null},{type:"datePiker",label:"时间",key:"time",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"作者",key:"author",width:"",value:null,required:!0,defaultValue:null},{type:"richText",label:"内容",key:"content",width:"",value:null,required:!0,defaultValue:null},{type:"cascade",label:"所属栏目",key:"typeId",list:[],width:"",value:"",props:{checkStrictly:!0,label:"name",value:"id"},typeList:[],required:!0,defaultValue:""},{type:"uploadImg",label:"封面",placeholder:"请上传图片",key:"img",width:"",value:"",defaultValue:""},{type:"uploadFileMul",label:"附件",buttonText:"上传附件",placeholder:"请上传附件",key:"path",width:"",value:"",defaultValue:""},{type:"radio",label:"审核",placeholder:"请输入",key:"status",width:"",value:"",defaultValue:1,required:!0,options:[{name:"同意",value:1},{name:"不同意",value:0}]}],formList:[{label:"索引",key:"id",value:null,defaultValue:null},{type:"input",label:"标题",key:"name",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"来源",key:"source",width:"",value:null,required:!0,defaultValue:null},{type:"datePiker",label:"时间",key:"time",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"作者",key:"author",width:"",value:null,required:!0,defaultValue:null},{type:"richText",label:"内容",key:"content",width:"",value:null,required:!0,defaultValue:null},{type:"cascade",label:"所属栏目",key:"typeId",list:[],width:"",value:"",props:{checkStrictly:!0,label:"name",value:"id"},typeList:[],required:!0,defaultValue:""},{type:"uploadImg",label:"封面",placeholder:"请上传图片",key:"img",width:"",value:"",defaultValue:""},{type:"uploadFileMul",label:"附件",buttonText:"上传附件",placeholder:"请上传附件",key:"path",width:"",listFile:[],value:"",defaultValue:""},{type:"radio",label:"附件可否下载",placeholder:"请审核",key:"isDownload",width:"",value:"",options:[{name:"同意",value:1},{name:"不同意",value:0}]}],roles:["superadmin","ColumnAdministrator","PlatformAdministrator"],authorization:""}),t=Object(l["ref"])({searchInfo:{},searchInit:[{name:"isSelect",desc:"专业",value:"searchProfession",placeholder:"请选择选择专业",options:[]},{name:"isSelect",desc:"科室",value:"searchDepartment",placeholder:"请选择选择科室",options:[]}],leftBtn:[{name:"添加",fn:()=>{console.log(111111)}},{name:"删除",type:"danger"}]});Object(l["watch"])(()=>O["a"].currentRoute.value.query,t=>{e.authorization=t.code});const a=async(t,a)=>{const l=await m["a"].get(a,{limit:999}),o=[];m["a"].childNo(l.list,o),e.tableColumns[t].list=o},o=async()=>{const t=await m["a"].get("/ps_menus/getListByPage",{typeId:null,limit:999});t.list.forEach(e=>{e.value=e.id}),e.searchInit[1].options=t.list};o(),a(3,"/ps_menus/getListByPage");const s=e=>{m["a"].post("/message/resetPass",{id:e.data.id}).then(e=>{e.success&&m["a"].msg(e.msg)})},r=t=>{const a=JSON.parse(JSON.stringify(t)),l={name:a.name,source:a.source,time:a.time,author:a.author,content:a.content,code:a.code||"",status:a.status||-1,typeId:"object"===typeof a.typeId?a.typeId[a.typeId.length-1]:a.typeId,sequence:e.nowRow.id?e.nowRow.sequence:(new Date).getTime(),path:a.path,isDownload:a.isDownload,img:a.img};if(e.pageParams.isEdit)return l.id=a.id,void m["a"].post("/message/updateById",l).then(t=>{t.success&&(e.pageParams.isDrawer=!1,m["a"].msg(t.msg),e.pageParams.refresh=!0)});m["a"].post("/message/create",l).then(t=>{t.success&&(m["a"].msg(t.msg),e.pageParams.isDrawer=!1,e.pageParams.refresh=!0)})},n=t=>{e.searchInfo.status=t.status,t.name&&(e.searchInfo.name=t.name.indexOf("undefined")>-1?null:t.name.substring(1,t.name.length-1)),t.typeId&&(e.searchInfo.typeId=t.typeId)},c=t=>{e.nowRow={...t.row},e.apply=!1,m["a"].openDrawer(e.pageParams,!0,e.applyParam,t.row)},i=t=>{e.apply=!0,t?(e.nowRow={...t.row},m["a"].openDrawer(e.pageParams,!0,e.formList,t.row)):(e.nowRow={sequence:null,id:null},m["a"].openDrawer(e.pageParams))},d=(t,a,l)=>{m["a"].get(t,{limit:10,offset:1}).then(t=>{e[a]=t.list,l&&l()})},u=()=>{e.tableData.forEach(t=>{e.typeData.forEach(e=>{-1!==t.typeId.indexOf(e.id)&&(t.typeName=e.name)})})},b=()=>{m["a"].get("/ps_menus/getListByPage",{limit:299}).then(t=>{const a=[];t.list.length>0&&(t.list.forEach(e=>{["首页","管理系统","资料下载","招生培训","教师风采","教学动态","规章制度","在线课程"].includes(e.name)||a.push(e)}),e.formList.forEach(e=>{"所属栏目"===e.label&&(e.list=a)}),e.applyParam.forEach(e=>{"所属栏目"===e.label&&(e.list=a)}))})},y=()=>{e.pageParams.refresh=!0};return b(),Object(l["onBeforeMount"])(()=>{d("/message/getListByPage","tableData",()=>{d("/message_type/getListByPage","typeData",u)});const t=Object(p["c"])(),a=t.query;e.authorization=a.code||""}),{searchData:t,...Object(l["toRefs"])(e),resetPass:s,submit:r,search:n,applyFn:c,setFn:i,approvalFn:y,tools:m["a"]}}}),g=a("6b0d"),w=a.n(g);const v=w()(j,[["render",d]]);t["default"]=v},f10b:function(e,t,a){"use strict";var l=a("7a23");const o={style:{display:"inline","margin-left":"10px"}},s={class:"flex align-center"},r={style:{"margin-top":"8px"}},n={style:{color:"#666666","margin-bottom":"8px"}},c={key:0,class:"font-orange font-bold"},i={key:1,class:"font-green font-bold"},d={key:2,class:"font-red font-bold"},p={class:"padding-start"},u={key:0,style:{color:"#666666","margin-bottom":"8px"}},m={key:0,style:{margin:"16px 0"}};function b(e,t,a,b,y,h){const f=Object(l["resolveComponent"])("strip-title"),O=Object(l["resolveComponent"])("el-timeline-item"),j=Object(l["resolveComponent"])("el-timeline"),g=Object(l["resolveComponent"])("el-button"),w=Object(l["resolveComponent"])("el-dialog");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,[Object(l["createVNode"])(w,{modelValue:e.isApprovalDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.isApprovalDialog=t),"destroy-on-close":""},{title:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",s,[Object(l["createVNode"])(f,null,{default:Object(l["withCtx"])(()=>t[4]||(t[4]=[Object(l["createTextVNode"])("审批进度查看")])),_:1}),t[5]||(t[5]=Object(l["createTextVNode"])("   "))])]),default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(j,null,{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.approvalList,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(O,{key:e.id,placement:"bottom",size:"large",type:"primary"},{default:Object(l["withCtx"])(()=>[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e["roleName"])+" ",1),Object(l["createElementVNode"])("div",r,[Object(l["createElementVNode"])("p",n,[11===e.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",c,"待审核")):Object(l["createCommentVNode"])("",!0),1===e.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",i,"通过✅")):Object(l["createCommentVNode"])("",!0),0===e.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",d,"驳回❌")):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("small",p,Object(l["toDisplayString"])(e["approvalDate"]),1)]),e.remark?(Object(l["openBlock"])(),Object(l["createElementBlock"])("p",u,"审批意见："+Object(l["toDisplayString"])(e.remark),1)):Object(l["createCommentVNode"])("",!0)])]),_:2},1024))),128))]),_:1}),0===a.data.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",m,[Object(l["createVNode"])(g,{onClick:t[0]||(t[0]=t=>e.submitApproval(a.data.row)),type:"warning"},{default:Object(l["withCtx"])(()=>t[6]||(t[6]=[Object(l["createTextVNode"])("重新提交审核")])),_:1})])):Object(l["createCommentVNode"])("",!0)]),_:1},8,["modelValue"]),-1===a.data.row.status?(Object(l["openBlock"])(),Object(l["createBlock"])(g,{key:0,size:"small",type:"danger",onClick:t[2]||(t[2]=t=>e.submitApproval(a.data.row))},{default:Object(l["withCtx"])(()=>t[7]||(t[7]=[Object(l["createTextVNode"])(" 提交审批 ")])),_:1})):Object(l["createCommentVNode"])("",!0),11===a.data.row.status||0===a.data.row.status?(Object(l["openBlock"])(),Object(l["createBlock"])(g,{key:1,size:"small",type:"success",onClick:t[3]||(t[3]=t=>e.checkApprovalProcess(a.data.row))},{default:Object(l["withCtx"])(()=>t[8]||(t[8]=[Object(l["createTextVNode"])(" 审批进度 ")])),_:1})):Object(l["createCommentVNode"])("",!0)])}var y=a("44a6"),h=a("0613"),f={name:"approval",props:{data:{type:Object},param:{type:Object},typeCode:{type:String},tableName:{type:String}},setup:(e,{emit:t})=>{const a=Object(l["reactive"])({approvalProcessId:null,isApprovalDialog:!1,approvalList:[]}),o=async()=>{await y["a"].post("/api/rest/getApprovalProcessIdByTypeCode",{assignedRoleId:h["a"].state.manageUserInfo.currentRole.roleId,typeCode:e.typeCode}).then(e=>{const t=(e.data.listByAssignedRoleId.length>0?e.data.listByAssignedRoleId:e.data.listByTypeCode)||[];a.approvalProcessId=t.length>0?t[0].id:null}).catch(()=>{y["a"].msgError("您无权此操作！")})},s=l=>{null===a.approvalProcessId&&o(),y["a"].confirm("温馨提示","确定提交审批？").then(o=>{if(!o)return;const s=y["a"].showLoading("提交中...");l.staffId=h["a"].state.manageUserInfo.id,l.approvalProcessId=a.approvalProcessId,y["a"].post("/workflow/createProcess",{staffId:h["a"].state.manageUserInfo.id,objectId:l.id,approvalProcessId:a.approvalProcessId,tableName:e.tableName}).then(e=>{e.success&&(y["a"].msg(e.msg),t("approval",l)),y["a"].closeLoading(s)}).catch(()=>{y["a"].msgError("您无权此操作！")})})},r=e=>{null===a.approvalProcessId&&o(),a.isApprovalDialog=!0,y["a"].post("/workflowStart/getStepDetailList",{workflowId:e.workflowId,approvalProcessId:e.approvalProcessId}).then(e=>{a.approvalList=e.list})};return{...Object(l["toRefs"])(a),submitApproval:s,checkApprovalProcess:r,tools:y["a"]}}},O=a("6b0d"),j=a.n(O);const g=j()(f,[["render",b]]);t["a"]=g}}]);