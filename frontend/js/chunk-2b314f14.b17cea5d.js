(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b314f14"],{"813b":function(e,t,a){"use strict";a.r(t);var l=a("7a23");const o={class:"users-manage"},r={key:0,class:"font-warning font-bold"},s={key:1,class:"font-red font-bold"},n={key:2,class:"font-red font-bold"},c={key:3,class:"font-warning font-bold"},i={key:4,class:"font-green font-bold"};function d(e,t,a,d,p,u){const m=Object(l["resolveComponent"])("el-button"),b=Object(l["resolveComponent"])("search-class"),f=Object(l["resolveComponent"])("Preview"),y=Object(l["resolveComponent"])("Approval"),O=Object(l["resolveComponent"])("table-list"),j=Object(l["resolveComponent"])("form-list"),h=Object(l["resolveComponent"])("el-drawer");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,[Object(l["createVNode"])(b,{searchInit:e.searchInit,refresh:e.pageParams.refresh,"onUpdate:refresh":t[2]||(t[2]=t=>e.pageParams.refresh=t),isShowExportBtn:"false",onSearch:e.search},{"left-btn":Object(l["withCtx"])(()=>[Object(l["withDirectives"])(Object(l["createVNode"])(m,{onClick:t[0]||(t[0]=t=>e.setFn()),class:"background-btn",size:"small",type:"primary",plain:""},{default:Object(l["withCtx"])(()=>t[8]||(t[8]=[Object(l["createTextVNode"])("添加资料 ")])),_:1},512),[[l["vShow"],"add"===e.authorization]]),Object(l["createVNode"])(m,{type:"danger",plain:"",size:"small",onClick:t[1]||(t[1]=t=>e.tools.delMultiple("file",e.selection,e.pageParams))},{default:Object(l["withCtx"])(()=>t[9]||(t[9]=[Object(l["createTextVNode"])("删除 ")])),_:1})]),_:1},8,["searchInit","refresh","onSearch"]),Object(l["createVNode"])(O,{selection:e.selection,"onUpdate:selection":t[4]||(t[4]=t=>e.selection=t),columns:e.tableColumns,url:"/file/getListByPage","query-data":e.searchInfo,refresh:e.pageParams.refresh,"onUpdate:refresh":t[5]||(t[5]=t=>e.pageParams.refresh=t)},{status:Object(l["withCtx"])(e=>[-1===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",r,"未提交")):Object(l["createCommentVNode"])("",!0),0===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",s,"审核驳回")):Object(l["createCommentVNode"])("",!0),2===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",n,"禁用")):Object(l["createCommentVNode"])("",!0),11===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",c,"待审核")):Object(l["createCommentVNode"])("",!0),1===e.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",i,"启用")):Object(l["createCommentVNode"])("",!0)]),default:Object(l["withCtx"])(a=>[Object(l["withDirectives"])(Object(l["createVNode"])(m,{type:"primary",size:"small",onClick:t=>e.setFn(a)},{default:Object(l["withCtx"])(()=>t[10]||(t[10]=[Object(l["createTextVNode"])("查看/修改 ")])),_:2},1032,["onClick"]),[[l["vShow"],"add"===e.authorization]]),Object(l["createVNode"])(m,{type:"danger",size:"small",onClick:t=>e.tools.deleteById("file",a["row"].id,e.pageParams)},{default:Object(l["withCtx"])(()=>t[11]||(t[11]=[Object(l["createTextVNode"])("删除 ")])),_:2},1032,["onClick"]),Object(l["createVNode"])(f,{"ok-data":a["row"]},null,8,["ok-data"]),Object(l["createVNode"])(y,{data:a,refresh:e.pageParams.refresh,"onUpdate:refresh":t[3]||(t[3]=t=>e.pageParams.refresh=t),"table-name":"file","type-code":"file",onApproval:e.approvalFn},null,8,["data","refresh","onApproval"])]),_:1},8,["selection","columns","query-data","refresh"]),e.apply?(Object(l["openBlock"])(),Object(l["createBlock"])(h,{key:0,title:"详细信息",modelValue:e.pageParams.isDrawer,"onUpdate:modelValue":t[6]||(t[6]=t=>e.pageParams.isDrawer=t),direction:"rtl","append-to-body":!1,"destroy-on-close":!0,size:"40%"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(j,{list:e.formList,isEdit:e.pageParams.isEdit,onSubmit:e.submit},null,8,["list","isEdit","onSubmit"])]),_:1},8,["modelValue"])):(Object(l["openBlock"])(),Object(l["createBlock"])(h,{key:1,title:"详细信息",modelValue:e.pageParams.isDrawer,"onUpdate:modelValue":t[7]||(t[7]=t=>e.pageParams.isDrawer=t),direction:"rtl","append-to-body":!1,"destroy-on-close":!0,size:"40%"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(j,{list:e.applyParam,isEdit:e.pageParams.isEdit,onSubmit:e.submit},null,8,["list","isEdit","onSubmit"])]),_:1},8,["modelValue"]))])}var p=a("f220"),u=a("44a6"),m=a("d6de"),b=a("1f4d"),f=a("b02f"),y=a("f10b"),O=a("afbc"),j=a("6605"),h=Object(l["defineComponent"])({name:"",components:{FormList:b["a"],SearchClass:p["a"],TableList:m["a"],Preview:f["a"],Approval:y["a"]},setup:()=>{const e=Object(l["reactive"])({authorization:"",nowRow:{sequence:null,id:null},pageParams:{isEdit:!1,isDrawer:!1,refresh:!1},searchInfo:{status:null,name:null},selection:[],tableColumns:[{valueKey:"selection",label:"",type:"selection"},{valueKey:"name",label:"标题",width:180},{valueKey:"content",label:"描述"},{valueKey:"typeId",label:"栏目类型",list:[]},{valueKey:"path",label:"文件",width:180},{valueKey:"status",width:120,label:"状态",type:"slot"},{valueKey:"created",label:"创建日期",type:"time"}],searchInit:[{name:"isSelect",desc:"状态",placeholder:"选择状态",value:"status",valueKey:"status",defaultValue:null,options:[{status:null,name:"不限制"},{status:"-1",name:"未提交"},{status:"11",name:"待审核"},{status:"0",name:"驳回"},{status:"1",name:"启用"},{status:"2",name:"禁用"}]}],formList:[{label:"索引",key:"id",value:null,defaultValue:null},{type:"input",label:"文件名",key:"name",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"来源",key:"source",width:"",value:null,required:!0,defaultValue:null},{type:"datePiker",label:"时间",key:"time",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"发布人",key:"author",width:"",value:null,required:!0,defaultValue:null},{type:"textarea",label:"描述",key:"content",width:"",value:null,defaultValue:null},{type:"uploadFileMul",label:"文件",placeholder:"请上传文件",key:"path",buttonText:"上传文件",width:"",value:"",defaultValue:"",required:!0},{type:"select",label:"栏目类型",key:"typeId",width:"",value:null,url:"/ps_menus/getDataByIdMore",queryParams:{parentId:"2f9e8411-2de4-4ffc-8c4a-346f98859632"},httpType:"post",defaultValue:"",required:!0},{type:"radio",label:"附件可否下载",placeholder:"请审核",key:"isDownload",width:"",value:"",options:[{name:"同意",value:1},{name:"不同意",value:0}]}],apply:!1,applyParam:[{label:"索引",key:"id",value:null,defaultValue:null},{type:"input",label:"文件名",key:"name",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"来源",key:"source",width:"",value:null,required:!0,defaultValue:null},{type:"datePiker",label:"时间",key:"time",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"发布人",key:"author",width:"",value:null,required:!0,defaultValue:null},{type:"textarea",label:"描述",key:"content",width:"",value:null,defaultValue:null},{type:"uploadFileMul",label:"文件",buttonText:"上传文件",placeholder:"请上传",key:"path",width:"",value:"",required:!0,defaultValue:""},{type:"select",label:"栏目类型",key:"typeId",width:"",value:null,url:"/ps_menus/getDataByIdMore",queryParams:{parentId:"2f9e8411-2de4-4ffc-8c4a-346f98859632"},httpType:"post",defaultValue:"",required:!0},{type:"radio",label:"审核",placeholder:"请审核",key:"status",width:"",value:"",required:!0,options:[{name:"同意",value:1},{name:"不同意",value:0}]}],roles:["superadmin","ColumnAdministrator","PlatformAdministrator"]}),t=Object(l["ref"])({searchInfo:{},searchInit:[{name:"isSelect",desc:"专业",value:"searchProfession",placeholder:"请选择选择专业",options:[]},{name:"isSelect",desc:"科室",value:"searchDepartment",placeholder:"请选择选择科室",options:[]}],leftBtn:[{name:"添加",fn:()=>{console.log(111111)}},{name:"删除",type:"danger"}]});Object(l["watch"])(()=>O["a"].currentRoute.value.query,t=>{e.authorization=t.code});const a=async t=>{const a=await u["a"].post("/ps_menus/getDataByIdMore",{parentId:"2f9e8411-2de4-4ffc-8c4a-346f98859632"});e.tableColumns[t].list=a.data};a(3);const o=e=>{u["a"].post("/file/resetPass",{id:e.data.id}).then(e=>{e.success&&u["a"].msg(e.msg)})},r=t=>{const a=JSON.parse(JSON.stringify(t)),l={name:a.name,source:a.source,time:a.time,author:a.author,content:a.content,code:a.code||"",status:a.status||-1,path:a.path,typeId:a.typeId,isDownload:a.isDownload,sequence:e.nowRow.id?e.nowRow.sequence:(new Date).getTime()};if(e.pageParams.isEdit)return l.id=a.id,void u["a"].post("/file/updateById",l).then(t=>{t.success&&(e.pageParams.isDrawer=!1,u["a"].msg(t.msg),e.pageParams.refresh=!0)});u["a"].post("/file/create",l).then(t=>{t.success&&(u["a"].msg(t.msg),e.pageParams.isDrawer=!1,e.pageParams.refresh=!0)})},s=t=>{e.searchInfo.status=t.status,t.name&&(e.searchInfo.name=t.name.indexOf("undefined")>-1||2===t.name.length?null:t.name.substring(1,t.name.length-1))},n=t=>{e.apply=!1,u["a"].openDrawer(e.pageParams,!0,e.applyParam,t.row)},c=t=>{e.apply=!0,t?(e.nowRow={...t.row},u["a"].openDrawer(e.pageParams,!0,e.formList,t.row)):(e.nowRow={sequence:null,id:null},u["a"].openDrawer(e.pageParams))},i=()=>{e.pageParams.refresh=!0};return Object(l["onBeforeMount"])(()=>{const t=Object(j["c"])(),a=t.query;e.authorization=a.code||""}),{searchData:t,...Object(l["toRefs"])(e),resetPass:o,submit:r,search:s,applyFn:n,setFn:c,approvalFn:i,tools:u["a"]}}}),w=a("6b0d"),v=a.n(w);const k=v()(h,[["render",d]]);t["default"]=k},f10b:function(e,t,a){"use strict";var l=a("7a23");const o={style:{display:"inline","margin-left":"10px"}},r={class:"flex align-center"},s={style:{"margin-top":"8px"}},n={style:{color:"#666666","margin-bottom":"8px"}},c={key:0,class:"font-orange font-bold"},i={key:1,class:"font-green font-bold"},d={key:2,class:"font-red font-bold"},p={class:"padding-start"},u={key:0,style:{color:"#666666","margin-bottom":"8px"}},m={key:0,style:{margin:"16px 0"}};function b(e,t,a,b,f,y){const O=Object(l["resolveComponent"])("strip-title"),j=Object(l["resolveComponent"])("el-timeline-item"),h=Object(l["resolveComponent"])("el-timeline"),w=Object(l["resolveComponent"])("el-button"),v=Object(l["resolveComponent"])("el-dialog");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,[Object(l["createVNode"])(v,{modelValue:e.isApprovalDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.isApprovalDialog=t),"destroy-on-close":""},{title:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",r,[Object(l["createVNode"])(O,null,{default:Object(l["withCtx"])(()=>t[4]||(t[4]=[Object(l["createTextVNode"])("审批进度查看")])),_:1}),t[5]||(t[5]=Object(l["createTextVNode"])("   "))])]),default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(h,null,{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.approvalList,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(j,{key:e.id,placement:"bottom",size:"large",type:"primary"},{default:Object(l["withCtx"])(()=>[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e["roleName"])+" ",1),Object(l["createElementVNode"])("div",s,[Object(l["createElementVNode"])("p",n,[11===e.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",c,"待审核")):Object(l["createCommentVNode"])("",!0),1===e.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",i,"通过✅")):Object(l["createCommentVNode"])("",!0),0===e.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",d,"驳回❌")):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("small",p,Object(l["toDisplayString"])(e["approvalDate"]),1)]),e.remark?(Object(l["openBlock"])(),Object(l["createElementBlock"])("p",u,"审批意见："+Object(l["toDisplayString"])(e.remark),1)):Object(l["createCommentVNode"])("",!0)])]),_:2},1024))),128))]),_:1}),0===a.data.row.status?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",m,[Object(l["createVNode"])(w,{onClick:t[0]||(t[0]=t=>e.submitApproval(a.data.row)),type:"warning"},{default:Object(l["withCtx"])(()=>t[6]||(t[6]=[Object(l["createTextVNode"])("重新提交审核")])),_:1})])):Object(l["createCommentVNode"])("",!0)]),_:1},8,["modelValue"]),-1===a.data.row.status?(Object(l["openBlock"])(),Object(l["createBlock"])(w,{key:0,size:"small",type:"danger",onClick:t[2]||(t[2]=t=>e.submitApproval(a.data.row))},{default:Object(l["withCtx"])(()=>t[7]||(t[7]=[Object(l["createTextVNode"])(" 提交审批 ")])),_:1})):Object(l["createCommentVNode"])("",!0),11===a.data.row.status||0===a.data.row.status?(Object(l["openBlock"])(),Object(l["createBlock"])(w,{key:1,size:"small",type:"success",onClick:t[3]||(t[3]=t=>e.checkApprovalProcess(a.data.row))},{default:Object(l["withCtx"])(()=>t[8]||(t[8]=[Object(l["createTextVNode"])(" 审批进度 ")])),_:1})):Object(l["createCommentVNode"])("",!0)])}var f=a("44a6"),y=a("0613"),O={name:"approval",props:{data:{type:Object},param:{type:Object},typeCode:{type:String},tableName:{type:String}},setup:(e,{emit:t})=>{const a=Object(l["reactive"])({approvalProcessId:null,isApprovalDialog:!1,approvalList:[]}),o=async()=>{await f["a"].post("/api/rest/getApprovalProcessIdByTypeCode",{assignedRoleId:y["a"].state.manageUserInfo.currentRole.roleId,typeCode:e.typeCode}).then(e=>{const t=(e.data.listByAssignedRoleId.length>0?e.data.listByAssignedRoleId:e.data.listByTypeCode)||[];a.approvalProcessId=t.length>0?t[0].id:null}).catch(()=>{f["a"].msgError("您无权此操作！")})},r=l=>{null===a.approvalProcessId&&o(),f["a"].confirm("温馨提示","确定提交审批？").then(o=>{if(!o)return;const r=f["a"].showLoading("提交中...");l.staffId=y["a"].state.manageUserInfo.id,l.approvalProcessId=a.approvalProcessId,f["a"].post("/workflow/createProcess",{staffId:y["a"].state.manageUserInfo.id,objectId:l.id,approvalProcessId:a.approvalProcessId,tableName:e.tableName}).then(e=>{e.success&&(f["a"].msg(e.msg),t("approval",l)),f["a"].closeLoading(r)}).catch(()=>{f["a"].msgError("您无权此操作！")})})},s=e=>{null===a.approvalProcessId&&o(),a.isApprovalDialog=!0,f["a"].post("/workflowStart/getStepDetailList",{workflowId:e.workflowId,approvalProcessId:e.approvalProcessId}).then(e=>{a.approvalList=e.list})};return{...Object(l["toRefs"])(a),submitApproval:r,checkApprovalProcess:s,tools:f["a"]}}},j=a("6b0d"),h=a.n(j);const w=h()(O,[["render",b]]);t["a"]=w}}]);