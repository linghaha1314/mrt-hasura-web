(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4352c18a"],{"725f":function(e,t,a){"use strict";a.r(t);a("14d9");var l=a("7a23"),o=a("44a6"),c=a("f220"),r=a("d8e8");const n={class:"page-box"},s={class:"flex",style:{"flex-direction":"row-reverse","margin-right":"20px"}};var d=Object(l["defineComponent"])({__name:"ApprovalProcess",setup(e){const t=Object(l["ref"])([]),a=(Object(l["ref"])([]),Object(l["ref"])([]),Object(l["ref"])(!1)),d=Object(l["reactive"])({pageParams:{isEdit:!1,isDrawer:!1},refresh:!1,queryParams:{limit:20,offset:0,where:{parent_id:{_is_null:!0},name:{_like:"%%"}}},list:[],roles:[],approvalType:null,approvalTypeList:[],approvalId:null,approvalList:[{content:"支持使用图标",size:"large",roleId:null,type:"primary"}],options:[],value:"",total:0,searchData:{},selection:[],tableList:[],tableColumns:[{label:"名称",valueKey:"name"},{label:"审批类型",valueKey:"typeName"}],searchInit:[{name:"isSelect",desc:"专业",value:"searchProfession",placeholder:"请选择选择专业",options:[]},{name:"isSelect",desc:"科室",value:"searchDepartment",placeholder:"请选择选择科室",options:[]}]}),i=Object(l["ref"])(r["a"]),p=Object(l["reactive"])({name:null,typeId:null,assignedRoleId:null}),u=Object(l["reactive"])({name:[{required:!0,message:"请输入审批名",trigger:"blur"}],typeId:[{required:!0,message:"请选择审批类型",trigger:"blur"}]}),b=e=>{d.queryParams.where.name._like=e.name,d.queryParams={...d.queryParams}},m=()=>{o["a"].get("/roles/getListByPage",{limit:200}).then(e=>{d.roles=e.list})},O=async e=>{a.value=!0;const l=await o["a"].get("/roles/getListByPage",{limit:100,name:e});a.value=!1,t.value=l.list},j=()=>{if(!i.value.validate())return;let e=!1;if(d.approvalList.forEach(t=>{t.roleId&&(e=!0)}),!e)return void o["a"].msgError("请至少选择一个审批人");const t=o["a"].showLoading("提交中...");o["a"].post("/approvalProcessSet/createUpdateData",{id:d.approvalId,name:p.name,typeId:p.typeId,assignedRoleId:p.assignedRoleId,list:d.approvalList}).then(e=>{o["a"].closeLoading(t),e.success&&(g(),d.pageParams.isDrawer=!1,o["a"].msg(e.msg))})},h=()=>{o["a"].post("/dictionaryData/getByTypeCode",{typeCode:"approvalType"}).then(e=>{e.success&&(d.approvalTypeList=e.list)})},f=e=>{d.queryParams.limit=e,g()},y=e=>{d.queryParams.offset=d.queryParams.limit*(e-1),g()},k=async e=>{const t=await o["a"].confirm();t&&o["a"].post("/approvalProcess/delete",{id:e.id}).then(e=>{g()})},v=e=>{if("isAdd"!==e)d.pageParams.isDrawer=!0,p.name=e.name,p.typeId=e.typeId||null,p.assignedRoleId=e.assignedRoleId||null,d.approvalId=e.id,d.approvalList=JSON.parse(JSON.stringify(e.children));else{d.approvalId=null,d.approvalList=[{content:"支持使用图标",size:"large",roleId:null,type:"primary"}],d.pageParams.isDrawer=!0,p.assignedRoleId=null;try{i.value.resetFields()}catch(t){console.log(t)}}},g=()=>{o["a"].post("/approvalProcessSet/getDataListByPage",{...d.queryParams}).then(e=>{d.tableList=e.list,d.total=e.total})},V=()=>{d.approvalList.length>=4?o["a"].msg("温馨提示：最多三级审批人！","warning"):d.approvalList.push({content:d.approvalList.length+"级审批人",size:"large",roleId:null,if:"select"})};return Object(l["onMounted"])(()=>{m(),g(),O(""),h()}),Object(l["watch"])(()=>d.refresh,e=>{e&&(g(),d.refresh=!1)}),(e,o)=>{const m=Object(l["resolveComponent"])("el-button"),h=Object(l["resolveComponent"])("el-step"),g=Object(l["resolveComponent"])("el-steps"),C=Object(l["resolveComponent"])("el-table-column"),w=Object(l["resolveComponent"])("el-table"),N=Object(l["resolveComponent"])("el-pagination"),B=Object(l["resolveComponent"])("el-input"),x=Object(l["resolveComponent"])("el-form-item"),I=Object(l["resolveComponent"])("el-option"),_=Object(l["resolveComponent"])("el-select"),E=Object(l["resolveComponent"])("el-card"),S=Object(l["resolveComponent"])("el-timeline-item"),D=Object(l["resolveComponent"])("el-timeline"),L=Object(l["resolveComponent"])("el-dialog");return Object(l["openBlock"])(),Object(l["createElementBlock"])(l["Fragment"],null,[Object(l["createVNode"])(c["a"],{refresh:d.refresh,"onUpdate:refresh":o[2]||(o[2]=e=>d.refresh=e),searchData:d.searchData,"onUpdate:searchData":o[3]||(o[3]=e=>d.searchData=e),searchInit:d.searchInit,onSearch:b},{"left-btn":Object(l["withCtx"])(()=>[Object(l["createVNode"])(m,{class:"background-btn",plain:"",size:"small",type:"primary",onClick:o[0]||(o[0]=e=>v("isAdd"))},{default:Object(l["withCtx"])(()=>o[9]||(o[9]=[Object(l["createTextVNode"])("新增 ")])),_:1}),Object(l["createVNode"])(m,{plain:"",size:"small",type:"danger",onClick:o[1]||(o[1]=t=>k(e.props.row))},{default:Object(l["withCtx"])(()=>o[10]||(o[10]=[Object(l["createTextVNode"])("删除 ")])),_:1})]),_:1},8,["refresh","searchData","searchInit"]),Object(l["createVNode"])(w,{data:d.tableList,style:{width:"100%"}},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(C,{type:"expand"},{default:Object(l["withCtx"])(e=>[Object(l["createVNode"])(g,{active:2,"align-center":""},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.row.children,(e,t)=>(Object(l["openBlock"])(),Object(l["createBlock"])(h,{key:e.id,description:t+1+"级审批人",title:e["roleName"]},null,8,["description","title"]))),128))]),_:2},1024)]),_:1}),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(d.tableColumns,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(C,{key:e.label,label:e.label,prop:e.valueKey},null,8,["label","prop"]))),128)),Object(l["createVNode"])(C,{label:"操作",prop:"opera"},{default:Object(l["withCtx"])(e=>[Object(l["createVNode"])(m,{size:"small",type:"text",onClick:t=>v(e.row)},{default:Object(l["withCtx"])(()=>o[11]||(o[11]=[Object(l["createTextVNode"])("查看/修改 ")])),_:2},1032,["onClick"]),Object(l["createVNode"])(m,{class:"font-red",size:"small",type:"text",onClick:t=>k(e.row)},{default:Object(l["withCtx"])(()=>o[12]||(o[12]=[Object(l["createTextVNode"])("删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),Object(l["createElementVNode"])("div",n,[Object(l["createVNode"])(N,{"page-size":d.queryParams.limit,"page-sizes":[10,20,50,100],total:d.total,background:"",layout:"total,sizes,prev, pager, next,jumper",onSizeChange:f,onCurrentChange:y},null,8,["page-size","total"])]),Object(l["createVNode"])(L,{modelValue:d.pageParams.isDrawer,"onUpdate:modelValue":o[8]||(o[8]=e=>d.pageParams.isDrawer=e),title:"设置审批流程"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Object(l["unref"])(r["a"]),{class:"padding-start padding-end",ref_key:"ruleFormRef",ref:i,model:p,rules:u},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(D,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(S,{placement:"top",size:"large",timestamp:"审批名称&审批类型",type:"primary"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(E,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(x,{label:"审批名称",prop:"name"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(B,{modelValue:p.name,"onUpdate:modelValue":o[4]||(o[4]=e=>p.name=e),placeholder:"请输入审批流程名",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(x,{label:"审批类型",prop:"typeId"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(_,{modelValue:p.typeId,"onUpdate:modelValue":o[5]||(o[5]=e=>p.typeId=e),placeholder:"选择审批类型",filterable:"","reserve-keyword":""},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(d.approvalTypeList,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(x,{label:"指定提交人"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(_,{modelValue:p["assignedRoleId"],"onUpdate:modelValue":o[6]||(o[6]=e=>p["assignedRoleId"]=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"输入角色名","remote-method":O,loading:a.value},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t.value,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(I,{key:e["id"],label:e.name,value:e["id"]},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(d.approvalList,(e,o)=>(Object(l["openBlock"])(),Object(l["createBlock"])(S,{key:o,color:e.color,timestamp:o+1+"级审批人",placement:"top",size:"large",type:"primary"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(_,{modelValue:e.roleId,"onUpdate:modelValue":t=>e.roleId=t,filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"输入角色名","remote-method":O,loading:a.value},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t.value,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(I,{key:e["id"],label:e.name,value:e["id"]},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading"])]),_:2},1032,["color","timestamp"]))),128)),d.approvalList.length<3?(Object(l["openBlock"])(),Object(l["createBlock"])(S,{key:0,placement:"top",size:"large",timestamp:"新增下级审批人，最多3级",type:"primary"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(m,{plain:"",size:"small",type:"warning",onClick:V},{default:Object(l["withCtx"])(()=>o[13]||(o[13]=[Object(l["createTextVNode"])("新增")])),_:1})]),_:1})):Object(l["createCommentVNode"])("",!0)]),_:1}),Object(l["createElementVNode"])("div",s,[Object(l["createVNode"])(m,{type:"primary",onClick:o[7]||(o[7]=e=>j())},{default:Object(l["withCtx"])(()=>o[14]||(o[14]=[Object(l["createTextVNode"])("保存")])),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});const i=d;t["default"]=i},cc43:function(e,t,a){"use strict";a("fcaf")},d250:function(e,t,a){"use strict";a("f27b")},f220:function(e,t,a){"use strict";a("14d9");var l=a("7a23"),o=a("415f"),c=a("c57c"),r=a("44a6");const n={class:"search-class-ul"},s={key:0,class:"time-choose-box"},d={key:1,class:"select-box"},i={key:2,class:"el-select-tree-box"},p={key:3,class:"el-select-tree-box"},u={key:4,class:"demo-date-picker",style:{margin:"10px"}},b={class:"block"},m={key:1,class:"opera-buttons"},O={class:""},j={style:{position:"absolute",top:"-20%",left:"0",visibility:"hidden"}};var h=Object(l["defineComponent"])({__name:"SearchClass",props:{searchInit:{type:Object,default:()=>[]},searchInfo:{type:Object,default:()=>({})},tableName:{type:Object,default:()=>({})},refresh:{type:Boolean,default:!1},isHideRight:{type:Boolean,default:!1},isShowReset:{type:Boolean,default:!1},searchKey:{type:String,default:"name"},isShowSearchInput:{type:Boolean,default:!0},list:{type:Array,default:()=>[]},tableColumns:{type:Array,default:()=>[]},placeholder:{type:String,default:"搜索"},isShowExportBtn:{type:Boolean,default:!1}},emits:["exportAll","update:refresh","update:tableColumns","update:searchInfo","search"],setup(e,{emit:t}){const a=Object(l["ref"])(!1),h=e,f=Object(l["ref"])(null),y=t,k=()=>{w.searchInfo={},y("update:searchInfo",{}),y("search",{}),y("update:refresh",!0)},v=(e,t)=>{if(e&&t.url){a.value=!0;const l={};t.isInWhereName&&e?t.queryParams.where.name={_like:e}:l[t.searchKey||"name"]=e,r["a"][t.httpType||"get"](t.url,{...t.queryParams,...l}||{}).then(e=>{a.value=!1,t.options=e.list})}else t.options=[]},g=(e,t)=>({disabledDate(t){if(e="today"===e?r["a"].formatTime(""):e,e&&e);else if(e)return new Date(e).getTime()>t.getTime()}}),V=()=>{y("exportAll")},C=Object(l["reactive"])({checkStrictly:!0,label:"name",value:"id"}),w=Object(l["reactive"])({inputSearch:"",cascadeChecked:(()=>{const e=[];return h.tableColumns.forEach(t=>{t.isHide||e.push([t.valueKey])}),e})(),pickerOptions:{shortcuts:[{text:"最近一周",onClick:e=>{const t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:e=>{const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:e=>{const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},searchInfo:{},categoryName:"",Refresh:o["a"]}),N=(e,t)=>{const a=JSON.parse(JSON.stringify(w.searchInfo));a[h.searchKey]?a[h.searchKey]="%"+a[h.searchKey].trim()+"%":delete a[h.searchKey],y("update:searchInfo",a),y("search",a),y("update:refresh",!0)},B=e=>{e.url&&v("%%",e)},x=()=>{y("update:refresh",!0)},I=(e,t)=>{w.categoryName=e.name,w.searchInfo[t.value]=e.name,y("search",{[t.value]:e.id}),y("update:refresh",!0)},_=e=>{const t=[],a=new Map(JSON.parse(JSON.stringify(w.cascadeChecked)));h.tableColumns.forEach(e=>{e.isHide=!a.has(e.valueKey),t.push(e)}),y("update:tableColumns",t)},E=()=>{console.log("==>>??",f.value),f.value.popperVisible=!0};return Object(l["onMounted"])(()=>{(h.searchInit||[]).forEach(e=>{e.defaultValue&&(w.searchInfo[e.value]=e.defaultValue)})}),(t,r)=>{const h=Object(l["resolveComponent"])("el-date-picker"),y=Object(l["resolveComponent"])("el-option"),S=Object(l["resolveComponent"])("el-select"),D=Object(l["resolveComponent"])("el-tree"),L=Object(l["resolveComponent"])("el-cascader"),P=Object(l["resolveComponent"])("el-button"),T=Object(l["resolveComponent"])("el-input"),z=Object(l["resolveComponent"])("el-button-group");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",n,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.searchInit,(e,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:o,class:"class-box"},["isTime"===e["name"]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",s,[Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e["desc"])+"：",1),e["daterange"]?(Object(l["openBlock"])(),Object(l["createBlock"])(h,{key:1,modelValue:w.searchInfo[e["value"]],"onUpdate:modelValue":t=>w.searchInfo[e["value"]]=t,"picker-options":t.pickerOptions,align:"right","end-placeholder":"结束日期","range-separator":"至",size:"small","start-placeholder":"开始日期",type:"derange","unlink-panels":""},null,8,["modelValue","onUpdate:modelValue","picker-options"])):(Object(l["openBlock"])(),Object(l["createBlock"])(h,{key:0,modelValue:w.searchInfo[e["value"]],"onUpdate:modelValue":t=>w.searchInfo[e["value"]]=t,placeholder:e["placeholder"],size:"small",type:"date"},null,8,["modelValue","onUpdate:modelValue","placeholder"]))])):"isSelect"===e["name"]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",d,[Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e["desc"])+"：",1),Object(l["createVNode"])(S,{modelValue:w.searchInfo[e["value"]],"onUpdate:modelValue":t=>w.searchInfo[e["value"]]=t,loading:a.value,placeholder:e["placeholder"],"remote-method":t=>{v(t,e)},filterable:"",remote:"",clearable:!e["isNotClearable"],size:"small",onChange:N,onFocus:t=>B(e)},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e["options"],t=>(Object(l["openBlock"])(),Object(l["createBlock"])(y,{key:t.id,label:t[e["labelKey"]]||t.name,value:t[e["valueKey"]]||t.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","loading","placeholder","remote-method","clearable","onFocus"])])):"isSelectTree"===e["name"]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",i,[Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e["desc"])+"：",1),Object(l["createVNode"])(S,{modelValue:w.searchInfo[e["value"]],"onUpdate:modelValue":t=>w.searchInfo[e["value"]]=t,placeholder:e["placeholder"]},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(y,{label:t.categoryName,value:e["categoryId"],style:{height:"auto",padding:"0"}},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(D,{ref_for:!0,ref:"tree",data:e.options,"node-key":e.id,props:e["formatProps"],"highlight-current":"",onNodeClick:t=>I(t,e)},null,8,["data","node-key","props","onNodeClick"])]),_:2},1032,["label","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])):"isCascader"===e["name"]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",p,[Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e["desc"])+"：",1),Object(l["createVNode"])(L,{modelValue:w.searchInfo[e["value"]],"onUpdate:modelValue":t=>w.searchInfo[e["value"]]=t,disabled:e.disabled,options:e.list,placeholder:e.placeholder,props:e.props||C,"show-all-levels":!1,clearable:"",onChange:t=>{N(t,e)}},null,8,["modelValue","onUpdate:modelValue","disabled","options","placeholder","props","onChange"])])):"daterange"===e["name"]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",u,[Object(l["createElementVNode"])("div",b,[r[2]||(r[2]=Object(l["createElementVNode"])("span",{class:"demonstration"},"选择周期：",-1)),Object(l["createVNode"])(h,{modelValue:w.searchInfo[e["value"]],"onUpdate:modelValue":t=>w.searchInfo[e["value"]]=t,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small","unlink-panels":"","picker-options":g(e.maxDate),onChange:t=>{N(t,e)}},null,8,["modelValue","onUpdate:modelValue","picker-options","onChange"])])])):Object(l["createCommentVNode"])("",!0)]))),128)),e.isShowReset?(Object(l["openBlock"])(),Object(l["createBlock"])(P,{key:0,size:"small",type:"primary",plain:"",onClick:k},{default:Object(l["withCtx"])(()=>r[3]||(r[3]=[Object(l["createTextVNode"])("重置")])),_:1})):Object(l["createCommentVNode"])("",!0),e.isHideRight?Object(l["createCommentVNode"])("",!0):(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",m,[Object(l["createElementVNode"])("div",O,[Object(l["renderSlot"])(t.$slots,"left-btn")]),Object(l["createElementVNode"])("div",null,[e.isShowSearchInput?(Object(l["openBlock"])(),Object(l["createBlock"])(T,{key:0,modelValue:w.searchInfo[e.searchKey],"onUpdate:modelValue":r[0]||(r[0]=t=>w.searchInfo[e.searchKey]=t),placeholder:e.placeholder,size:"small",style:{width:"200px","margin-right":"16px"},onInput:N,clearable:""},null,8,["modelValue","placeholder"])):Object(l["createCommentVNode"])("",!0),Object(l["createVNode"])(z,{class:"ml-4",size:"small"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(P,{icon:Object(l["unref"])(o["a"]),onClick:x},null,8,["icon"]),Object(l["createVNode"])(P,{icon:Object(l["unref"])(c["a"]),onClick:E,style:{position:"relative"}},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",j,[Object(l["createVNode"])(L,{"popper-class":"table-column-list-choose",modelValue:w.cascadeChecked,"onUpdate:modelValue":r[1]||(r[1]=e=>w.cascadeChecked=e),ref_key:"cascadeRef",ref:f,options:e.tableColumns,props:{value:"valueKey",multiple:!0},"collapse-tags":"",onChange:_},null,8,["modelValue","options"])])]),_:1},8,["icon"]),e.isShowExportBtn?(Object(l["openBlock"])(),Object(l["createBlock"])(P,{key:0,onClick:V},{default:Object(l["withCtx"])(()=>r[4]||(r[4]=[Object(l["createTextVNode"])(" 导出全部 ")])),_:1})):Object(l["createCommentVNode"])("",!0),Object(l["renderSlot"])(t.$slots,"right-group-btn")]),_:3})])]))])}}}),f=(a("cc43"),a("d250"),a("6b0d")),y=a.n(f);const k=y()(h,[["__scopeId","data-v-bef45afa"]]);t["a"]=k},f27b:function(e,t,a){},fcaf:function(e,t,a){}}]);