(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b81c2b4"],{"06bb":function(e,t,a){"use strict";a.r(t);var l=a("7a23");const o={class:"users-manage"};function s(e,t,a,s,r,i){const n=Object(l["resolveComponent"])("el-button"),c=Object(l["resolveComponent"])("import-file"),d=Object(l["resolveComponent"])("search-class"),u=Object(l["resolveComponent"])("table-list"),p=Object(l["resolveComponent"])("strip-title"),m=Object(l["resolveComponent"])("form-list"),b=Object(l["resolveComponent"])("el-dialog"),y=Object(l["resolveComponent"])("el-drawer");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,[Object(l["createVNode"])(d,{refresh:e.pageParams.refresh,"onUpdate:refresh":t[2]||(t[2]=t=>e.pageParams.refresh=t),placeholder:"输入姓名或帐号搜索",isShowPage:!1,searchInit:e.searchInit,onSearch:e.search,tableColumns:e.tableColumns,"onUpdate:tableColumns":t[3]||(t[3]=t=>e.tableColumns=t),"is-show-export-btn":!0,onExportAll:e.exportFn},{"left-btn":Object(l["withCtx"])(()=>[Object(l["createVNode"])(n,{class:"background-btn",plain:"",size:"small",type:"primary",onClick:t[0]||(t[0]=t=>e.$tools.openDrawer(e.pageParams))},{default:Object(l["withCtx"])(()=>t[10]||(t[10]=[Object(l["createTextVNode"])("新增用户 ")])),_:1}),Object(l["createVNode"])(c,{"model-file":"./xlsx/人员数据信息模板.xlsx","model-name":"人员数据信息模板.xlsx",config:e.definePropsArr,changeData:e.changeData,"table-name":"user",refresh:e.pageParams.refresh,"onUpdate:refresh":t[1]||(t[1]=t=>e.pageParams.refresh=t)},null,8,["config","changeData","refresh"]),Object(l["createVNode"])(n,{class:"background-btn",plain:"",size:"small",type:"primary",onClick:e.exportFn},{default:Object(l["withCtx"])(()=>t[11]||(t[11]=[Object(l["createTextVNode"])("全部导出 ")])),_:1},8,["onClick"])]),_:1},8,["refresh","searchInit","onSearch","tableColumns","onExportAll"]),Object(l["createVNode"])(u,{list:e.list,"onUpdate:list":t[4]||(t[4]=t=>e.list=t),refresh:e.pageParams.refresh,"onUpdate:refresh":t[5]||(t[5]=t=>e.pageParams.refresh=t),selection:e.selection,"onUpdate:selection":t[6]||(t[6]=t=>e.selection=t),columns:e.tableColumns,"onUpdate:columns":t[7]||(t[7]=t=>e.tableColumns=t),httpType:"post",queryData:e.searchInfo,url:"/user/getUserListByPage"},{default:Object(l["withCtx"])(a=>["MMCZY"!==e.roleCode?(Object(l["openBlock"])(),Object(l["createBlock"])(n,{key:0,size:"small",type:"primary",onClick:t=>e.$tools.openDrawer(e.pageParams,!0,e.formList,a.row)},{default:Object(l["withCtx"])(()=>t[12]||(t[12]=[Object(l["createTextVNode"])("查看/修改 ")])),_:2},1032,["onClick"])):Object(l["createCommentVNode"])("",!0),"MMCZY"!==e.roleCode?(Object(l["openBlock"])(),Object(l["createBlock"])(n,{key:1,size:"small",type:"warning",onClick:t=>e.setRole(a.row)},{default:Object(l["withCtx"])(()=>t[13]||(t[13]=[Object(l["createTextVNode"])("角色 ")])),_:2},1032,["onClick"])):Object(l["createCommentVNode"])("",!0),Object(l["createVNode"])(n,{size:"small",type:"info",onClick:t=>e.resetPass(a.row)},{default:Object(l["withCtx"])(()=>t[14]||(t[14]=[Object(l["createTextVNode"])("重置密码 ")])),_:2},1032,["onClick"]),a.row.locked?(Object(l["openBlock"])(),Object(l["createBlock"])(n,{key:2,size:"small",type:"warning",onClick:t=>e.unLocked(a.row)},{default:Object(l["withCtx"])(()=>t[15]||(t[15]=[Object(l["createTextVNode"])("解锁 ")])),_:2},1032,["onClick"])):Object(l["createCommentVNode"])("",!0),"MMCZY"!==e.roleCode?(Object(l["openBlock"])(),Object(l["createBlock"])(n,{key:3,size:"small",type:"danger",onClick:t=>e.tools.deleteById("user",a.row.id,e.pageParams,"id","/user/deleteUserById")},{default:Object(l["withCtx"])(()=>t[16]||(t[16]=[Object(l["createTextVNode"])("删除 ")])),_:2},1032,["onClick"])):Object(l["createCommentVNode"])("",!0)]),_:1},8,["list","refresh","selection","columns","queryData"]),e.isSetRole?(Object(l["openBlock"])(),Object(l["createBlock"])(b,{key:0,modelValue:e.isSetRole,"onUpdate:modelValue":t[8]||(t[8]=t=>e.isSetRole=t),"append-to-body":!1,"destroy-on-close":!0,title:"角色设置",width:"30%"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(m,{isEdit:!0,list:e.roleList,onSubmit:e.roleSubmit},{title:Object(l["withCtx"])(()=>[Object(l["createVNode"])(p,{class:"margin-bottom"},{default:Object(l["withCtx"])(()=>t[17]||(t[17]=[Object(l["createTextVNode"])("基本")])),_:1})]),_:1},8,["list","onSubmit"])]),_:1},8,["modelValue"])):(Object(l["openBlock"])(),Object(l["createBlock"])(y,{key:1,modelValue:e.pageParams.isDrawer,"onUpdate:modelValue":t[9]||(t[9]=t=>e.pageParams.isDrawer=t),"append-to-body":!1,"destroy-on-close":!0,direction:"rtl",size:"40%",title:"用户详细信息"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(m,{isEdit:e.pageParams.isEdit,list:e.formList,onSubmit:e.submit},{title:Object(l["withCtx"])(()=>[Object(l["createVNode"])(p,{class:"margin-bottom"},{default:Object(l["withCtx"])(()=>t[18]||(t[18]=[Object(l["createTextVNode"])("基本")])),_:1})]),_:1},8,["isEdit","list","onSubmit"])]),_:1},8,["modelValue"]))])}var r=a("f220"),i=a("44a6"),n=a("d6de"),c=a("1f4d"),d=a("9a45"),u=a("3ef4"),p=a("0613"),m=a("3452"),b=a.n(m),y=a("0e71"),f=Object(l["defineComponent"])({name:"",components:{ImportFile:y["a"],StripTitle:d["a"],FormList:c["a"],SearchClass:r["a"],TableList:n["a"]},setup:()=>{const e=async()=>{const e=await i["a"].get("/roles/getListByPage",{limit:1e3});t.tableColumns[5].list=e.list},t=Object(l["reactive"])({pageParams:{isEdit:!1,isDrawer:!1,refresh:!1},isSetRole:!1,definePropsArr:[{field:"name",text:"姓名",require:!0},{field:"jobNum",text:"工号",require:!0},{field:"username",text:"账号",require:!0},{field:"sex",text:"性别"},{field:"education",text:"学历"},{field:"positionTitle",text:"医生职称"},{field:"post",text:"岗位"},{field:"duties",text:"职位"},{field:"sectionId",text:"所属科室"},{field:"majorId",text:"所属专业"},{field:"hospital",text:"院区"},{field:"mobile",text:"手机号码"},{field:"email",text:"邮箱"},{field:"personnelType",text:"人员类型"},{field:"department",text:"所属部门"}],defineProps:{"姓名":"name","性别":"sex","账号":"username","工号":"jobNum","学历":"education","人员类型":"personnelType","所属部门":"department","所属科室":"sectionId","所属专业":"majorId","岗位":"post","职务":"duties","院区":"hospital","医生职称":"positionTitle","手机号码":"mobile","邮箱":"email"},list:[],searchInfo:{where:{name:{_like:"%%"}}},selection:[],tableColumns:[{valueKey:"selection",label:"",type:"selection"},{valueKey:"avatar",label:"头像",type:"avatar",width:100},{valueKey:"name",label:"姓名",width:120},{valueKey:"sectionName",label:"科室",width:120},{valueKey:"username",label:"帐号",width:120},{valueKey:"roles",width:120,label:"角色",list:[]},{valueKey:"mobile",width:120,label:"手机号"},{valueKey:"created",label:"创建日期",type:"time"}],searchInit:[{name:"isSelect",desc:"角色",searchKey:"name",placeholder:"选择角色",value:"role_id",url:"/roles/getListByPage",queryParams:{limit:1e3}},{name:"isSelect",desc:"科室",url:"/section/getListByPage",placeholder:"选择科室",value:"section_id"}],formList:[{type:"slot",name:"title"},{type:"none",key:"id",width:"",value:null,required:!0,defaultValue:null},{type:"input",label:"账号",key:"username",width:"",value:null,required:!0,defaultValue:"",change:e=>{i["a"].validationRepeat(e,"账号","username","user")}},{type:"input",label:"姓名",key:"name",width:"",value:null,defaultValue:"",required:!0},{type:"number",label:"工号",key:"jobNum",width:"",value:null,defaultValue:"",change:e=>{i["a"].validationRepeat(e,"工号","jobNum","user")},required:!0},{type:"select",label:"所属专业",key:"majorId",width:"",url:"/major/getList",searchKey:"search",value:null,defaultValue:null},{type:"remote-select",url:"/section/getListByPage",label:"科室",key:"sectionId",width:"",value:null,options:[],defaultValue:null},{type:"input",label:"手机号码",key:"mobile",width:"",value:"",defaultValue:null},{type:"select",label:"性别",key:"sex",width:"",value:null,url:"/dictionaryData/getByTypeCode",queryParams:{typeCode:"sex"},optionsValue:"name",httpType:"post",required:!0,defaultValue:[]},{type:"input",label:"学历",key:"education",width:"",value:null,defaultValue:""},{type:"select",label:"人员类别",key:"personnelType",width:"",value:null,url:"/dictionaryData/getByTypeCode",queryParams:{typeCode:"staffType"},optionsValue:"name",httpType:"post",required:!0,defaultValue:[]},{type:"input",label:"所属部门",key:"department",width:"",value:null,defaultValue:""},{type:"input",label:"岗位",key:"post",width:"",value:null,defaultValue:""},{type:"input",label:"职务",key:"duties",width:"",value:null,defaultValue:""},{type:"input",label:"院区",key:"hospital",width:"",value:null,defaultValue:""},{type:"select",label:"职称",key:"positionTitle",width:"",value:null,url:"/dictionaryData/getByTypeCode",queryParams:{typeCode:"positionName"},optionsValue:"name",httpType:"post",defaultValue:[]},{type:"input",label:"邮箱",key:"email",width:"",value:null,defaultValue:""}],roleList:[{type:"none",key:"id",width:"",value:null,required:!0,defaultValue:null},{type:"select",multiple:!0,label:"角色",key:"roles",width:"",url:"/roles/getListByPage",value:null,queryParams:{limit:1e4},defaultValue:"",required:!0}],currentRow:{username:""},sections:{},majors:{},sectionsIds:{},majorsIds:{},rules:[{title:"sectionId",arr:[]},{title:"majorId",arr:[]}],roleCode:JSON.parse(sessionStorage.getItem("manageUserInfo")).currentRole.roleData.code||""}),a=e=>{i["a"].confirm("温馨提示:","确认重置密码为: Zzrmyy@#168 吗?").then(t=>{if(!t)return!1;i["a"].post("/user/resetPass",{id:e.id}).then(e=>{e.success&&i["a"].msg(e.msg)})})},o=e=>{const a=i["a"].showLoading("解锁中...");i["a"].post("/user/updateById",{errorNum:5,locked:!1,id:e.id}).then(e=>{i["a"].closeLoading(a),e.success&&(i["a"].msg(e.msg),t.pageParams.refresh=!0)})},s=e=>{const a=JSON.parse(JSON.stringify(e));t.pageParams.isEdit?i["a"].post("/user/updateUserById",a).then(e=>{e.success&&Object(u["a"])({message:e.msg,type:"success",duration:2e3,onClose:()=>{t.pageParams.isDrawer=!1,t.pageParams.refresh=!0}})}):(delete a.id,a.password=b.a.AES.encrypt("Zzrmyy@#168","kb12315").toString(),i["a"].post("/user/createUser",a).then(e=>{e.success&&(i["a"].msg(e.msg),t.pageParams.isDrawer=!1,t.pageParams.refresh=!0)}))},r=e=>{const a=JSON.parse(JSON.stringify(e)),l=i["a"].showLoading("提交中...");i["a"].post("/userRole/createUpdate",a).then(e=>{i["a"].closeLoading(l),e.success&&(t.isSetRole=!1,t.pageParams.refresh=!0,p["a"].dispatch("getManageUserInfo",{id:p["a"].state.manageUserInfo.id}).then())})},n=e=>{t.roleList.forEach(t=>{t.value=e[t.key]}),t.isSetRole=!0};Object(l["onMounted"])(()=>{e()});const c=e=>{const a={where:{}};for(const[t,l]of Object.entries(e)){let e={};e="name"===t?{_like:l}:{_eq:l},l&&("name"===t?a.where[/^[0-9]*$/.test(l.replace(/%/g,""))?"username":"name"]=e:"role_id"===t?a.where.roles={[t]:{...e}}:a.where[t]=e)}t.searchInfo=a},d=()=>{i["a"].get("/section/getListByPage",{limit:999}).then(e=>{const a=[];i["a"].childNo(e.list,a),a.forEach(e=>{t.sections[e.name]=e.id,t.sectionsIds[e.id]=e.name})})},m=()=>{i["a"].get("/major/getListByPage",{limit:999}).then(e=>{const a=[];i["a"].childNo(e.list,a),a.forEach(e=>{t.majors[e.name]=e.id,t.majorsIds[e.id]=e.name})})},y=()=>{i["a"].get("/user/getList").then(e=>{const a=e.list,l=[...a];l.forEach(e=>{e.sectionId=t.sectionsIds[e.sectionId],e.majorId=t.majorsIds[e.majorId]}),i["a"].writeFile(l,t.defineProps)})},f=async e=>{const t=(await i["a"].getValueObjByHttp("/major/getList")).obj,a=(await i["a"].getValueObjByHttp("/section/getList")).obj;return e.forEach(e=>{e.majorId=t[e.majorId]||null,e.sectionId=a[e.sectionId]||null}),{list:e,uniqueKey:"username"}};return m(),d(),{tools:i["a"],...Object(l["toRefs"])(t),roleSubmit:r,resetPass:a,getRoles:e,unLocked:o,changeData:f,submit:s,search:c,setRole:n,exportFn:y}}}),h=a("6b0d"),j=a.n(h);const g=j()(f,[["render",s]]);t["default"]=g},"9a45":function(e,t,a){"use strict";var l=a("7a23");const o={class:"flex justify-between"},s={class:"strip-icon-box"},r={class:"flex align-center"};function i(e,t,a,i,n,c){return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,[Object(l["createElementVNode"])("div",s,[Object(l["createElementVNode"])("p",{style:Object(l["normalizeStyle"])({background:a.backColor}),class:"primary-back"},null,4),Object(l["createElementVNode"])("span",{style:Object(l["normalizeStyle"])({"font-size":a.font+"px"})},[Object(l["renderSlot"])(e.$slots,"default",{},()=>[Object(l["createTextVNode"])(Object(l["toDisplayString"])(a.name),1)],!0)],4)]),Object(l["createElementVNode"])("div",r,[Object(l["renderSlot"])(e.$slots,"right",{},void 0,!0)])])}var n={props:{backColor:{type:String,default:"#842d4f"},font:{type:String,default:"18"},name:{type:String,default:""}}},c=(a("c377"),a("6b0d")),d=a.n(c);const u=d()(n,[["render",i],["__scopeId","data-v-5ca8a69e"]]);t["a"]=u},"9f86":function(e,t,a){},c377:function(e,t,a){"use strict";a("9f86")}}]);